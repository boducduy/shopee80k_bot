<!DOCTYPE html>

<html lang="vi">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>ƒê·∫∑t Voucher Shopee</title>

    <!-- SDK Telegram WebApp -->

    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>

        body { 

            /* N·ªÅn x√°m r·∫•t nh·∫°t ƒë·ªÉ l√†m n·ªïi b·∫≠t form tr·∫Øng ·ªü gi·ªØa */

            background-color: #f3f4f6; 

            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;

            padding-bottom: 100px; /* ƒê·ªÉ tr√°nh n√∫t submit che n·ªôi dung */

        }

        

        .input-field {

            @apply mt-2 block w-full px-4 py-3 bg-white border border-gray-300 rounded-lg text-base text-gray-900 

            focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all;

        }

        

        /* Style ti√™u ƒë·ªÅ m·ª•c: ƒê·∫≠m, r√µ r√†ng */

        .section-title {

            @apply block text-base font-bold text-gray-800 mb-1;

        }

        

        /* Icon trong √¥ nh·∫≠p li·ªáu */

        .input-icon {

            @apply absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-400;

        }



        /* Style cho radio button ch·ªçn lo·∫°i voucher */

        .voucher-option:checked + div {

            border-color: #ee4d2d;

            background-color: #fff1f0;

            box-shadow: 0 4px 6px -1px rgba(238, 77, 45, 0.1), 0 2px 4px -1px rgba(238, 77, 45, 0.06);

        }

        .voucher-option:checked + div .check-icon {

            opacity: 1;

        }

        /* Style cho gi√° ti·ªÅn tr√™n n√∫t */

        .price-display {

            font-size: 1.1em;

            font-weight: 800;

            margin-left: 8px;

            color: #fff;

            background: rgba(255, 255, 255, 0.2);

            padding: 2px 8px;

            border-radius: 6px;

        }

        

        /* Animation fade in cho link m·ªõi */

        .fade-in {

            animation: fadeIn 0.3s ease-in-out;

        }

        @keyframes fadeIn {

            from { opacity: 0; transform: translateY(-5px); }

            to { opacity: 1; transform: translateY(0); }

        }

    </style>

</head>

<body class="min-h-screen py-8 px-4 flex justify-center items-start">



    <!-- Container ch√≠nh -->

    <div class="w-full max-w-lg bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">

        

        <!-- Header m√†u cam n·ªïi b·∫≠t -->

        <div class="bg-gradient-to-r from-orange-500 to-red-500 p-6 text-center text-white relative overflow-hidden">

            <div class="absolute top-0 left-0 w-full h-full bg-white opacity-5 transform -skew-x-12"></div>

            <h2 class="text-2xl md:text-3xl font-extrabold uppercase tracking-wide relative z-10">üì¶ ƒê∆°n ƒê·∫∑t H√†ng</h2>

            <p class="text-orange-100 text-sm mt-1 relative z-10">Ch·ªçn lo·∫°i Voucher v√† ƒëi·ªÅn th√¥ng tin b√™n d∆∞·ªõi</p>

        </div>



        <form id="orderForm" class="p-6 space-y-6">

            

            <!-- 0. CH·ªåN LO·∫†I VOUCHER (QUAN TR·ªåNG) -->

            <div class="bg-orange-5 border border-orange-100 rounded-xl p-4">

                <label class="section-title text-orange-800 mb-3 flex items-center">

                    <i class="fas fa-ticket-alt mr-2 text-orange-600"></i> Ch·ªçn lo·∫°i Voucher <span class="text-red-500 ml-1">*</span>

                </label>

                <div class="grid grid-cols-2 gap-4">

                    <!-- Option 60k -->

                    <label class="cursor-pointer relative group">

                        <!-- Th√™m onchange ƒë·ªÉ c·∫≠p nh·∫≠t gi√° -->

                        <input type="radio" name="voucherType" value="60k" class="voucher-option sr-only" onchange="updatePrice()">

                        <div class="border-2 border-gray-200 rounded-xl p-3 text-center transition-all h-full flex flex-col justify-center items-center relative bg-white group-hover:border-orange-200">

                            <span class="font-bold text-gray-800 text-lg">Voucher 60k</span>

                            <!-- ƒê√£ c·∫≠p nh·∫≠t text hi·ªÉn th·ªã ·ªü ƒë√¢y -->

                            <div class="text-sm text-gray-500 mt-1" id="labelPrice60">20k/l∆∞·ª£t</div>

                            <i class="fas fa-check-circle check-icon absolute top-2 right-2 text-orange-500 opacity-0 transition-opacity text-lg"></i>

                        </div>

                    </label>



                    <!-- Option 80k -->

                    <label class="cursor-pointer relative group">

                        <!-- Th√™m onchange ƒë·ªÉ c·∫≠p nh·∫≠t gi√° -->

                        <input type="radio" name="voucherType" value="80k" class="voucher-option sr-only" checked onchange="updatePrice()">

                        <div class="border-2 border-gray-200 rounded-xl p-3 text-center transition-all h-full flex flex-col justify-center items-center relative bg-white group-hover:border-orange-200">

                            <span class="font-bold text-gray-800 text-lg">Voucher 80k</span>

                             <div class="text-sm text-gray-500 mt-1" id="labelPrice80">29k/l∆∞·ª£t</div>

                            <i class="fas fa-check-circle check-icon absolute top-2 right-2 text-orange-500 opacity-0 transition-opacity text-lg"></i>

                        </div>

                    </label>

                </div>

            </div>



            <!-- 1. Link S·∫£n Ph·∫©m -->

            <div>

                <label class="section-title flex justify-between items-center">

                    <span>1. Link S·∫£n Ph·∫©m <span class="text-red-500">*</span></span>

                </label>

                <div id="linkContainer">

                    <div class="relative mb-3">

                        <div class="input-icon"><i class="fas fa-link"></i></div>

                        <input type="url" name="productLink" required class="input-field pl-12" placeholder="D√°n link Shopee s·ªë 1...">

                    </div>

                </div>

                <!-- N√∫t th√™m link -->

                <button type="button" id="addLinkBtn" class="text-sm font-semibold text-orange-600 bg-orange-50 hover:bg-orange-100 px-4 py-2 rounded-lg transition-colors flex items-center">

                    <i class="fas fa-plus-circle mr-2"></i> Th√™m link s·∫£n ph·∫©m kh√°c

                </button>

            </div>



            <!-- 2.T√™n+S·ªë ƒëi·ªán tho·∫°i -->

            <div>

                <label class="section-title">2. T√™n + S·ªë ƒëi·ªán tho·∫°i <span class="text-gray-400 font-normal text-sm ml-1">(QUEN SHIP B·ªé QUA)</span></label>

                <div class="relative">

                    <!-- Icon ƒë·ªïi th√†nh address-book ƒë·ªÉ h·ª£p v·ªõi t√™n + sƒët h∆°n -->

                    <div class="input-icon"><i class="fas fa-address-book"></i></div>

                    <!-- QUAN TR·ªåNG: ƒê√£ ƒë·ªïi type="tel" th√†nh type="text" ƒë·ªÉ nh·∫≠p ch·ªØ -->

                    <input type="text" id="phoneNumber" class="input-field pl-12" placeholder="V√≠ d·ª•: N Nam(091,234,5678)">

                </div>

            </div>



            <!-- 3. T√™n SP -->

            <div>

                <label class="section-title">3. T√™n S·∫£n Ph·∫©m</label>

                <div class="relative">

                    <div class="input-icon"><i class="fas fa-box-open"></i></div>

                    <input type="text" id="productName" class="input-field pl-12" placeholder="V√≠ d·ª•: √Åo thun ƒëen, Gi√†y size 40...">

                </div>

            </div>



            <!-- H√†ng ngang: Ph√¢n lo·∫°i & S·ªë l∆∞·ª£ng -->

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                <!-- 4. Ph√¢n lo·∫°i -->

                <div>

                    <label class="section-title">4. Ph√¢n lo·∫°i <span class="text-red-500">*</span></label>

                    <div class="relative">

                        <div class="input-icon"><i class="fas fa-list-ul"></i></div>

                        <input type="text" id="variant" required class="input-field pl-12" placeholder="M√†u, Size (GHI R√ï)">

                    </div>

                </div>



                <!-- 5. S·ªë l∆∞·ª£ng -->

                <div>

                    <label class="section-title">5. S·ªë l∆∞·ª£ng</label>

                    <div class="relative">

                        <div class="input-icon"><i class="fas fa-sort-numeric-up"></i></div>

                        <!-- S·ªë l∆∞·ª£ng ch·ªâ ƒë·ªÉ hi·ªÉn th·ªã, kh√¥ng t√≠nh ti·ªÅn -->

                        <input type="number" id="quantity" value="1" min="1" class="input-field pl-12 font-bold text-center">

                    </div>

                </div>

            </div>



            <!-- 6. Ghi ch√∫ -->

            <div>

                <label class="section-title">6. Ghi ch√∫</label>

                <div class="relative">

                    <div class="absolute top-4 left-0 pl-4 flex items-center pointer-events-none text-gray-400"><i class="fas fa-pen"></i></div>

                    <textarea id="note" rows="2" class="input-field pl-12" placeholder="Ghi ch√∫ th√™m cho admin..."></textarea>

                </div>

            </div>



            <!-- 7. ƒê·ªãa ch·ªâ nh·∫≠n h√†ng -->

            <div class="bg-gray-50 border border-gray-200 rounded-xl p-5">

                <label class="section-title text-gray-700 mb-3 flex items-center">

                    <i class="fas fa-map-marker-alt mr-2 text-red-500"></i> 7. ƒê·ªãa ch·ªâ nh·∫≠n h√†ng <span class="text-red-500 ml-1">*</span>

                </label>

                

                <div class="space-y-3">

                    <select id="province" class="input-field" required>

                        <option value="">-- Ch·ªçn T·ªânh/Th√†nh ph·ªë --</option>

                    </select>



                    <select id="district" class="input-field bg-gray-100 text-gray-500" required disabled>

                        <option value="">-- Ch·ªçn Qu·∫≠n/Huy·ªán --</option>

                    </select>



                    <select id="ward" class="input-field bg-gray-100 text-gray-500" required disabled>

                        <option value="">-- Ch·ªçn Ph∆∞·ªùng/X√£ --</option>

                    </select>



                    <input type="text" id="addressDetail" required class="input-field" placeholder="S·ªë nh√†, t√™n ƒë∆∞·ªùng c·ª• th·ªÉ...">

                </div>

            </div>



            <!-- L∆∞u √Ω nh·ªè -->

            <div class="flex items-start gap-2 text-sm text-amber-600 bg-amber-50 p-3 rounded-lg border border-amber-100">

                <i class="fas fa-info-circle mt-1"></i>

                <span>L∆∞u √Ω: N·∫øu c√≥ nhi·ªÅu link, shop s·∫Ω chia ra t·ª´ng ƒë∆°n. M·ªói ƒë∆°n ship s·∫Ω l√† 1k.</span>

            </div>



            <!-- N√öT G·ª¨I (Fixed Bottom) -->

            <div class="fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-50">

                <div class="max-w-lg mx-auto">

                    <!-- N√∫t G·ª≠i hi·ªÉn th·ªã gi√° ti·ªÅn -->

                    <button type="submit" id="submitBtn" class="w-full bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white font-bold py-3.5 px-6 rounded-xl shadow-lg transform transition hover:scale-[1.01] active:scale-95 flex justify-center items-center text-lg">

                        <span>G·ª¨I ƒê∆†N H√ÄNG</span>

                        <span id="btnPriceDisplay" class="price-display">29.000ƒë</span>

                    </button>

                </div>

            </div>



        </form>

    </div>



    <script>

        const tg = window.Telegram.WebApp;

        tg.expand();



        // --- C·∫§U H√åNH GI√Å (M·∫∂C ƒê·ªäNH) ---

        // ƒê√£ c·∫≠p nh·∫≠t gi√° 60k th√†nh 20000

        let PRICE_60K = 20000;

        let PRICE_80K = 29000;



        // --- L·∫§Y GI√Å T·ª™ URL (BOT G·ª¨I SANG) ---

        // Bot Python g·ª≠i link d·∫°ng: ?v60=24000&v80=29000

        const urlParams = new URLSearchParams(window.location.search);

        if (urlParams.has('v60')) PRICE_60K = parseInt(urlParams.get('v60'));

        if (urlParams.has('v80')) PRICE_80K = parseInt(urlParams.get('v80'));



        // C·∫≠p nh·∫≠t nh√£n gi√° nh·ªè d∆∞·ªõi radio button

        document.getElementById('labelPrice60').innerText = new Intl.NumberFormat('vi-VN').format(PRICE_60K) + 'ƒë/l∆∞·ª£t';

        document.getElementById('labelPrice80').innerText = new Intl.NumberFormat('vi-VN').format(PRICE_80K) + 'ƒë/l∆∞·ª£t';



        // --- H√ÄM C·∫¨P NH·∫¨T GI√Å TR√äN N√öT ---

        function updatePrice() {

            const voucherType = document.querySelector('input[name="voucherType"]:checked').value;

            let finalPrice = 0;



            if (voucherType === '60k') {

                finalPrice = PRICE_60K;

            } else {

                finalPrice = PRICE_80K;

            }



            // Hi·ªÉn th·ªã l√™n n√∫t (ƒë·ªãnh d·∫°ng ti·ªÅn Vi·ªát)

            const formattedPrice = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(finalPrice);

            document.getElementById('btnPriceDisplay').innerText = formattedPrice;

        }



        // G·ªçi 1 l·∫ßn khi load trang ƒë·ªÉ hi·ªÉn th·ªã gi√° m·∫∑c ƒë·ªãnh (80k)

        updatePrice();





        // --- X·ª¨ L√ù TH√äM LINK ---

        document.getElementById('addLinkBtn').addEventListener('click', function() {

            const container = document.getElementById('linkContainer');

            const count = container.children.length + 1;

            

            const div = document.createElement('div');

            div.className = 'relative mb-3 fade-in flex items-center gap-2';

            div.innerHTML = `

                <div class="relative w-full">

                    <div class="input-icon"><i class="fas fa-link"></i></div>

                    <input type="url" name="productLink" class="input-field pl-12 mt-0" placeholder="D√°n link Shopee s·ªë ${count}...">

                </div>

                <button type="button" class="text-gray-400 hover:text-red-500 p-2 rounded-full hover:bg-red-50 transition-colors" onclick="removeLink(this)">

                    <i class="fas fa-trash-alt"></i>

                </button>

            `;

            container.appendChild(div);

        });



        function removeLink(btn) {

            btn.parentElement.remove();

        }



        // --- API ƒê·ªäA CH√çNH (T·ªânh/Th√†nh -> Qu·∫≠n/Huy·ªán -> Ph∆∞·ªùng/X√£) ---

        const provinceSelect = document.getElementById('province');

        const districtSelect = document.getElementById('district');

        const wardSelect = document.getElementById('ward');



        async function fetchLocations() {

            try {

                const res = await fetch('https://esgoo.net/api-tinhthanh/1/0.htm');

                const data = await res.json();

                if(data.error===0) {

                    provinceSelect.innerHTML = '<option value="">-- Ch·ªçn T·ªânh/Th√†nh ph·ªë --</option>';

                    data.data.forEach(p => provinceSelect.add(new Option(p.full_name, p.id)));

                }

            } catch(e){}

        }

        

        provinceSelect.onchange = async function() {

            districtSelect.innerHTML='<option>ƒêang t·∫£i...</option>';

            wardSelect.innerHTML='<option value="">-- Ch·ªçn Ph∆∞·ªùng/X√£ --</option>';

            districtSelect.disabled = true;

            wardSelect.disabled = true;

            districtSelect.classList.add('bg-gray-100', 'text-gray-500'); 

            

            const res = await fetch(`https://esgoo.net/api-tinhthanh/2/${this.value}.htm`);

            const d = await res.json();

            districtSelect.innerHTML='<option value="">-- Ch·ªçn Qu·∫≠n/Huy·ªán --</option>';

            d.data.forEach(x => districtSelect.add(new Option(x.full_name, x.id)));

            districtSelect.disabled=false;

            districtSelect.classList.remove('bg-gray-100', 'text-gray-500');

        };



        districtSelect.onchange = async function() {

            wardSelect.innerHTML='<option>ƒêang t·∫£i...</option>';

            wardSelect.disabled=true;

            wardSelect.classList.add('bg-gray-100', 'text-gray-500');



            const res = await fetch(`https://esgoo.net/api-tinhthanh/3/${this.value}.htm`);

            const d = await res.json();

            wardSelect.innerHTML='<option value="">-- Ch·ªçn Ph∆∞·ªùng/X√£ --</option>';

            d.data.forEach(x => wardSelect.add(new Option(x.full_name, x.id)));

            wardSelect.disabled=false;

            wardSelect.classList.remove('bg-gray-100', 'text-gray-500');

        };

        

        window.onload = fetchLocations;



        // --- X·ª¨ L√ù G·ª¨I D·ªÆ LI·ªÜU ---

        document.getElementById('orderForm').addEventListener('submit', function(e) {

            e.preventDefault();



            // 1. L·∫•y lo·∫°i voucher

            const voucherType = document.querySelector('input[name="voucherType"]:checked').value;



            // 2. G·ªôp t·∫•t c·∫£ c√°c link th√†nh chu·ªói, c√°ch nhau b·ªüi xu·ªëng d√≤ng

            const linkInputs = document.querySelectorAll('input[name="productLink"]');

            const links = Array.from(linkInputs)

                .map(input => input.value.trim())

                .filter(val => val !== '') // Lo·∫°i b·ªè √¥ tr·ªëng

                .join('\n'); // N·ªëi b·∫±ng xu·ªëng d√≤ng ƒë·ªÉ Bot Python d·ªÖ t√°ch



            if (!links) {

                tg.showAlert("Vui l√≤ng nh·∫≠p √≠t nh·∫•t 1 link s·∫£n ph·∫©m!");

                return;

            }



            // 3. ƒê·ªãa ch·ªâ

            const pName = provinceSelect.options[provinceSelect.selectedIndex]?.text || "";

            const dName = districtSelect.options[districtSelect.selectedIndex]?.text || "";

            const wName = wardSelect.options[wardSelect.selectedIndex]?.text || "";

            if (provinceSelect.value === "" || districtSelect.value === "" || wardSelect.value === "") {

                 tg.showAlert("Vui l√≤ng ch·ªçn ƒë·∫ßy ƒë·ªß ƒë·ªãa ch·ªâ!");

                 return;

            }

            const fullAddress = `${document.getElementById('addressDetail').value}, ${wName}, ${dName}, ${pName}`;



            // 4. Gom d·ªØ li·ªáu g·ª≠i v·ªÅ Bot

            const data = {

                voucherType: voucherType, // Quan tr·ªçng: G·ª≠i '60k' ho·∫∑c '80k'

                link: links,              // Chu·ªói link ƒë√£ g·ªôp

                phone: document.getElementById('phoneNumber').value || "---",

                code: document.getElementById('productName').value || "---",

                variant: document.getElementById('variant').value,

                quantity: document.getElementById('quantity').value, // V·∫´n g·ª≠i s·ªë l∆∞·ª£ng cho admin

                address: fullAddress,

                note: document.getElementById('note').value

            };



            // 5. G·ª≠i qua Telegram WebApp SDK

            tg.sendData(JSON.stringify(data));

        });

    </script>

</body>

</html>
